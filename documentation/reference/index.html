<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.4">
<meta name="description" content="This documentation describes the Hibersap library.">
<meta name="keywords" content="Hibersap, Java, JavaEE, SAP, JCo, JCA, Cuckoo, reference, learn, how to">
<title>Hibersap Reference Documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-right">
<div id="header">
<h1>Hibersap Reference Documentation</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">1. Introduction</a></li>
<li><a href="#installation">2. Installation</a>
<ul class="sectlevel2">
<li><a href="#the-hibersap-libraries">2.1. The Hibersap libraries</a></li>
<li><a href="#third-party-libraries">2.2. Third Party Libraries</a></li>
<li><a href="#the-cuckoo-resource-adapter-for-sap">2.3. The Cuckoo Resource Adapter for SAP</a></li>
<li><a href="#other-jca-compatible-resource-adapters">2.4. Other JCA compatible Resource Adapters</a></li>
<li><a href="#building-hibersap-applications-with-maven">2.5. Building Hibersap Applications with Maven</a></li>
</ul>
</li>
<li><a href="#configuration">3. Configuration</a>
<ul class="sectlevel2">
<li><a href="#xml-file-configuration">3.1. XML file configuration</a></li>
<li><a href="#programmatic-configuration">3.2. Programmatic configuration</a></li>
</ul>
</li>
<li><a href="#parameter-mapping">4. Parameter Mapping</a>
<ul class="sectlevel2">
<li><a href="#hibersap-annotations">4.1. Hibersap Annotations</a></li>
<li><a href="#type-conversion">4.2. Type Conversion</a></li>
<li><a href="#bean-validation">4.3. Bean Validation</a></li>
</ul>
</li>
<li><a href="#calling-sap-functions">5. Calling SAP Functions</a>
<ul class="sectlevel2">
<li><a href="#building-a-sessionmanager">5.1. Building a SessionManager</a></li>
<li><a href="#calling-a-function-in-sap">5.2. Calling a function in SAP</a></li>
<li><a href="#interceptors">5.3. Interceptors</a></li>
</ul>
</li>
<li><a href="#transactions">6. Transactions</a>
<ul class="sectlevel3">
<li><a href="#manual-transaction-handling">6.1. Manual transaction handling</a></li>
<li><a href="#automatic-transaction-handling">6.2. Automatic transaction handling</a></li>
</ul>
</li>
<li><a href="#authentification">7. Authentification</a>
<ul class="sectlevel2">
<li><a href="#configured-user">7.1. Configured User</a></li>
<li><a href="#per-session-authentication">7.2. Per-session authentication</a></li>
<li><a href="#single-sign-on">7.3. Single sign-on</a></li>
</ul>
</li>
<li><a href="#java-ee-integration">8. Java EE Integration</a>
<ul class="sectlevel2">
<li><a href="#transaction-management">8.1. Transaction Management</a></li>
<li><a href="#security-management">8.2. Security Management</a></li>
<li><a href="#jca-configuration">8.3. JCA Configuration</a></li>
<li><a href="#hibersap-ejb-tools">8.4. Hibersap EJB tools</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hibersap helps developers of Java applications to call business logic in SAP ERP.
Hibersap defines a <a href="#hibersap-annotations">set of Java annotations</a> to map SAP function modules to Java classes as well as a small, clean <a href="#calling-sap-functions">API</a> to execute these function modules and handle transaction and security aspects.
Hibersap&#8217;s programming model is quite similar to those of modern O/R mappers, significantly speeding up the development of SAP interfaces and making it much more fun to write the integration code.</p>
</div>
<div class="paragraph">
<p>Under the hood, Hibersap either uses the SAP Java Connector (JCo) or a JCA compatible resource adapter to communicate with the SAP backend.
While retaining the benefits of JCo and JCA like transactions, security, connection pooling, etc., developers can focus on writing business logic because the need for boilerplate code is largely reduced.</p>
</div>
<div class="paragraph">
<p>Hibersap can either be <a href="#programmatic-configuration">configured programmatically</a> or by providing an <a href="#xml-file-configuration">XML file</a>.
Switching between JCo and JCA is a sole matter of configuration, the program code remains unchanged.
This makes it possible to execute integration tests via JCo while using a resource adapter in the production environment.</p>
</div>
<div class="paragraph">
<p>Regarding <a href="#type-conversion">data type conversion</a> from ABAP to Java types, Hibersap per default uses the conversion as is done by JCo resp. the JCA Resource Adapter.
<a href="#custom-converters">Custom converters</a> may be used to implement special conversion logic.
Hibersap will then call the conversion code on-the-fly, before and after calling the function module in SAP.</p>
</div>
<div class="paragraph">
<p>Hibersap may be configured to use <a href="#bean-validation">Bean Validation (JSR 303)</a> to validate field values according to the standard Bean Validation annotations.</p>
</div>
<div class="paragraph">
<p>If the function module defines a standard Return structure or table, Hibersap is able to automatically detect an error state and throw a SapException which includes the information returned by SAP.</p>
</div>
<div class="paragraph">
<p>For <a href="#java-ee-integration">Java EE applications</a> it is recommended to use a resource adapter since it integrates seamlessly with Java EE containers.
Using the <a href="#hibersap-ejb-tools">Hibersap EJB</a> tools makes it very easy to call SAP from EJB methods making use of Container Managed Transactions and Container Managed Security.
In a managed environment calls to SAP functions may even be part of distributed transactions.</p>
</div>
<div class="paragraph">
<p>For advanced use cases, there are two types of <a href="#interceptors">interceptors</a> that work on different levels of the call stack.</p>
</div>
<div class="paragraph">
<p>In the next chapters you will see out how easy it is to use Hibersap.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installation"><a class="anchor" href="#installation"></a>2. Installation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="the-hibersap-libraries"><a class="anchor" href="#the-hibersap-libraries"></a>2.1. The Hibersap libraries</h3>
<div class="paragraph">
<p>The Hibersap framework is divided into the following libraries:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>hibersap-core</p>
</li>
<li>
<p>hibersap-jco</p>
</li>
<li>
<p>hibersap-jca</p>
</li>
<li>
<p>hibersap-ejb</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When using Hibersap in conjunction with a JCA compatible resource adapter, both the hibersap-core and the hibersap-jca jars must be on the application&#8217;s classpath.
When using Hibersap with the SAP Java Connector (JCo), the hibersap-core and the hibersap-jco libraries are needed.</p>
</div>
<div class="paragraph">
<p>When using Hibersap with EJBs, you may consider using the EJB tools provided by the hibersap-ejb library.
The EJB tools provide an EJB3 interceptor which takes care of opening and closing sessions as well as injecting them into your EJBs at a special injection point denoted by a @HibersapSession annotation.
See section <a href="#hibersap-ejb-tools">Hibersap EJB Tools</a> for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="third-party-libraries"><a class="anchor" href="#third-party-libraries"></a>2.2. Third Party Libraries</h3>
<div class="paragraph">
<p>Hibersap has a few dependencies on third-party libraries, which you need to add to your application&#8217;s classpath. The easiest way to achieve this is to build your projects with Maven.
See section <a href="#building-hibersap-applications-with-maven">Building Hibersap Applications with Maven</a>.</p>
</div>
<div class="paragraph">
<p>Depending on which interfacing technology is actually used, you also need the SAP Java Connector (JCo)
or a JCA compatible resource adapter.</p>
</div>
<div class="sect3">
<h4 id="hibersap-dependencies"><a class="anchor" href="#hibersap-dependencies"></a>2.2.1. Hibersap Dependencies</h4>
<div class="paragraph">
<p>When using Maven, it will download the dependencies automatically during the build.
Otherwise, you need to add dependencies manually.
The following sections show Hibersap&#8217;s runtime dependencies and their version as Maven coordinates, so they can easily be downloaded from the Maven central repository.</p>
</div>
<div class="sect4">
<h5 id="hibersap-core-dependencies"><a class="anchor" href="#hibersap-core-dependencies"></a>hibersap-core Dependencies</h5>
<div class="ulist">
<ul>
<li>
<p>Apache Commons Lang: commons-lang:commons-lang:2.6</p>
</li>
<li>
<p>Apache Commons Logging: commons-logging:commons-logging:1.2</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="hibersap-jco-dependencies"><a class="anchor" href="#hibersap-jco-dependencies"></a>hibersap-jco Dependencies</h5>
<div class="ulist">
<ul>
<li>
<p>hibersap-core dependencies, plus:</p>
</li>
<li>
<p>SAP Java Connector (JCo) version 3.0.x (see section <a href="#the-sap-java-connector-jco">The SAP Java Connector (JCo)</a>)</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="hibersap-jca-dependencies"><a class="anchor" href="#hibersap-jca-dependencies"></a>hibersap-jca Dependencies</h5>
<div class="ulist">
<ul>
<li>
<p>hibersap-core dependencies, plus:</p>
</li>
<li>
<p>Java EE Connector Architecture API: javax.resource:connector:1.0 (or higher)</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="hibersap-ejb-dependencies"><a class="anchor" href="#hibersap-ejb-dependencies"></a>hibersap-ejb Dependencies</h5>
<div class="ulist">
<ul>
<li>
<p>Java Enterprise Java Beans API: javax.ejb:ejb-api:3.0 (or higher)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-sap-java-connector-jco"><a class="anchor" href="#the-sap-java-connector-jco"></a>2.2.2. The SAP Java Connector (JCo)</h4>
<div class="paragraph">
<p>The SAP JCo library is provided by SAP to their customers and comes with its own (commercial) license.
Thus it can not be provided by public Maven repositories or download sites.
Please check the following URL for more information and downloads: <a href="https://service.sap.com/connectors" class="bare">https://service.sap.com/connectors</a>.
You need to have an account for this URL, which may be obtained by SAP customers.
Valuable help regarding SAP technologies can also be found on the SAP Community Network (SCN): <a href="https://scn.sap.com" class="bare">https://scn.sap.com</a>.</p>
</div>
<div class="paragraph">
<p>After downloading SAP Java Connector 3.0, extract the sapjco3.jar and the sapjco3 native library.
You then need to install the sapjco3.jar into your local Maven repository or deploy it to your project&#8217;s or company&#8217;s remote repository.</p>
</div>
<div class="paragraph">
<p>To install it to your local Maven repository issue the following Maven command on the command line.
Since JCo is defined as an optional dependency in Hibersap, you can choose any values for groupId, artifactId and version.
You make sure your project&#8217;s pom.xml defines the dependency with the matching coordinates.</p>
</div>
<div class="paragraph">
<p>Note: The artifactId <code>com.sap.conn.jco.sapjco3</code> is a trick to work around a runtime check in the latest versions of
the SAP JCo library which enforces the name of the loaded jar file to either equal "sapjco3.jar" (or to start with
"com.sap.conn.jco").
Without this, Maven would rename the jar file to something like "sapjco3.jar-3.0.15.jar" when copying it
from the repository which would lead to runtime errors.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mvn install:install-file -DgroupId=org.hibersap \\
                         -DartifactId=com.sap.conn.jco.sapjco3 \\
                         -Dversion=3.0.15 \\
                         -Dpackaging=jar -Dfile=sapjco.jar</pre>
</div>
</div>
<div class="paragraph">
<p>The native library must be on your application&#8217;s library path.
You may copy it to a global library path, to a special directory such as <code>C:/WINDOWS/SYSTEM32</code> on Windows systems or to the execution directory of the application (e.g. the bin folder of your application server or the folder from which you run your application).
Additionally, the JCo jar file must be on the application&#8217;s classpath.</p>
</div>
<div class="paragraph">
<p>You may set the Java library path programmatically within your application by calling</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">System</span>.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">java.library.path</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/the/actual/path/to/sapjco3-native-lib/</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>or by passing it to the Java runtime when executing your Java application using</p>
</div>
<div class="listingblock">
<div class="content">
<pre>java [...] -Djava.library.path="/the/actual/path/to/sapjco3-native-lib/"</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-cuckoo-resource-adapter-for-sap"><a class="anchor" href="#the-cuckoo-resource-adapter-for-sap"></a>2.3. The Cuckoo Resource Adapter for SAP</h3>
<div class="paragraph">
<p>If you are using Hibersap with a resource adapter in a managed environment, the preferred choice is the Cuckoo Resource Adapter for SAP.
The project&#8217;s web site can be found under <a href="https://sourceforge.net/p/cuckoo-ra/home" class="bare">https://sourceforge.net/p/cuckoo-ra/home</a>.</p>
</div>
<div class="paragraph">
<p>You need to deploy the resource adapter to your application server. Since it uses the SAP Java Connector internally, the previous section also applies to this scenario, i.e. the SAP JCo has to be installed for use within the application server.</p>
</div>
</div>
<div class="sect2">
<h3 id="other-jca-compatible-resource-adapters"><a class="anchor" href="#other-jca-compatible-resource-adapters"></a>2.4. Other JCA compatible Resource Adapters</h3>
<div class="paragraph">
<p>Being the only open source resource adapters for SAP, Hibersap was tested with Cuckoo as well as the SAP BAPI JCA Adapter (see <a href="https://sourceforge.net/projects/sapbapijcaadapt" class="bare">https://sourceforge.net/projects/sapbapijcaadapt</a>).
Nevertheless, commercial alternatives do exist. We would be glad to get your feedback when using one of these.
Note that a resource adapter must implement the JCA Common Client Interface (CCI) to be supported by Hibersap.</p>
</div>
<div class="paragraph">
<p>Integrating another Resource Adapter in combination with application-managed authentication includes writing a Resource Adapter specific implementation of the interface <code>org.hibersap.execution.jca.cci.ConnectionSpecFactory</code>.
This is due to a limitation in the JCA specification which specifies the <code>javax.resource.cci.ConnectionSpec</code> as an empty interface, letting it up to the vendor-specific implementation to define which properties it contains.
Hibersap&#8217;s aim to support different resource adapters means that there must be a layer on top of the ConnectionSpec interface which makes it possible to adapt to different JCA implementations without having explicit dependencies to each of them.
Hibersap implements ConnectionSpecFactories for Cuckoo as well as the SAP BAPI JCA Adapter that use reflection for setting and getting the ConnectionSpec&#8217;s parameters in order to reduce (compile-time) dependencies to the individual resource adapters.</p>
</div>
<div class="paragraph">
<p>However, an implementation of the <code>ConnectionSpecFactory</code> is not needed if the application uses only container-managed authentication, because in this case Hibersap does not need to use a ConnectionSpec.</p>
</div>
</div>
<div class="sect2">
<h3 id="building-hibersap-applications-with-maven"><a class="anchor" href="#building-hibersap-applications-with-maven"></a>2.5. Building Hibersap Applications with Maven</h3>
<div class="paragraph">
<p>The Hibersap libraries are deployed to the Maven Central repository, so the dependencies are downloaded by Maven when you specify them in your project.</p>
</div>
<div class="paragraph">
<p>The following listing shows how to specify the dependencies to the Hibersap libraries in your pom.xml.</p>
</div>
<div class="paragraph">
<p>If you use Hibersap directly with JCo you need to declare the following dependencies in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.hibersap<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>hibersap-core<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>1.3.0<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;type&gt;</span>jar<span class="tag">&lt;/type&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.hibersap<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>hibersap-jco<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>1.3.0<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;type&gt;</span>jar<span class="tag">&lt;/type&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.hibersap<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>com.sap.conn.jco.sapjco3<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>3.0.15<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;type&gt;</span>jar<span class="tag">&lt;/type&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When using Hibersap with JCA you need to declare the following dependencies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.hibersap<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>hibersap-core<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>1.3.0<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;type&gt;</span>jar<span class="tag">&lt;/type&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.hibersap<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>hibersap-jca<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>1.3.0<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;type&gt;</span>jar<span class="tag">&lt;/type&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Due to Maven&#8217;s dependency management capabilities, all transient dependencies are automatically resolved so that there is no need to specify any of the above mentioned third-party libraries.
One exception to this is the dependency to the SAP Java Connector (JCo) which you need when using Hibersap directly with JCo. This dependency in declared as <em>optional</em> in the pom.xml of the hibersap-jco module. Because of this it is explicitly declared in the above example.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration"><a class="anchor" href="#configuration"></a>3. Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hibersap configuration consists of a set of properties.
There are two possibilities to configure Hibersap:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>XML file configuration</p>
</li>
<li>
<p>Programmatic configuration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>While bootstrapping Hibersap first tries to configure itself looking for the <code>/META-INF/hibersap.xml</code> file in the classpath.
When creating a SessionManager, configuration can be set or overwritten using programmatic configuration.</p>
</div>
<div class="paragraph">
<p>Using XML file configuration is usually the easiest way to configure Hibersap.</p>
</div>
<div class="sect2">
<h3 id="xml-file-configuration"><a class="anchor" href="#xml-file-configuration"></a>3.1. XML file configuration</h3>
<div class="paragraph">
<p>The format of the XML configuration file is inspired by JPA&#8217;s persistence.xml.
If you have to access different SAP systems, you can define more than one SessionManager by multiplying the session-manager XML element.</p>
</div>
<div class="paragraph">
<p>The following example shows XML file configuration when using Hibersap with JCo.
Note that you may use the Hibersap XML schema definition as shown in the hibersap element to get validation and auto-completion in your IDE or XML editor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;hibersap</span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://hibersap.org/xml/ns/hibersap-config</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://hibersap.org/xml/ns/hibersap-config</span>
                              <span class="content">https://hibersap.sourceforge.net/xml/hibersap_1_1.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;session-manager</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">A12</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;context&gt;</span>org.hibersap.execution.jco.JCoContext<span class="tag">&lt;/context&gt;</span>
    <span class="tag">&lt;properties&gt;</span>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jco.client.client</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">800</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jco.client.user</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sapuser</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jco.client.passwd</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jco.client.lang</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jco.client.ashost</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10.20.30.40</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jco.client.sysnr</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">00</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/properties&gt;</span>
    <span class="tag">&lt;annotated-classes&gt;</span>
      <span class="tag">&lt;annotated-class&gt;</span>org.hibersap.examples.flightlist.FlightListBapi<span class="tag">&lt;/annotated-class&gt;</span>
      <span class="tag">&lt;annotated-class&gt;</span>org.hibersap.examples.flightdetail.FlightDetailBapi<span class="tag">&lt;/annotated-class&gt;</span>
    <span class="tag">&lt;/annotated-classes&gt;</span>
  <span class="tag">&lt;/session-manager&gt;</span>
<span class="tag">&lt;/hibersap&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows the XML file configuration when using a JCA compatible resource adapter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;hibersap</span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://hibersap.org/xml/ns/hibersap-config</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://hibersap.org/xml/ns/hibersap-config</span>
                              <span class="content">http://hibersap.sourceforge.net/xml/hibersap_1_1.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;session-manager</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">A12</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;context&gt;</span>org.hibersap.execution.jca.JCAContext<span class="tag">&lt;/context&gt;</span>
    <span class="tag">&lt;jca-connection-factory&gt;</span>java:/eis/sap/A12<span class="tag">&lt;/jca-connection-factory&gt;</span>
    <span class="tag">&lt;jca-connectionspec-factory&gt;</span>
      org.hibersap.execution.jca.cci.SapBapiJcaAdapterConnectionSpecFactory
    <span class="tag">&lt;/jca-connectionspec-factory&gt;</span>
    <span class="tag">&lt;annotated-classes&gt;</span>
      <span class="tag">&lt;annotated-class&gt;</span>org.hibersap.examples.flightlist.FlightListBapi<span class="tag">&lt;/annotated-class&gt;</span>
      <span class="tag">&lt;annotated-class&gt;</span>org.hibersap.examples.flightdetail.FlightDetailBapi<span class="tag">&lt;/annotated-class&gt;</span>
    <span class="tag">&lt;/annotated-classes&gt;</span>
  <span class="tag">&lt;/session-manager&gt;</span>
<span class="tag">&lt;/hibersap&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Following is a complete list of Hibersap&#8217;s configuration parameters.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">context</dt>
<dd>
<p>The fully qualified class name of the Context class. This class must implement <code>org.hibersap.session.Context</code> and acts as a facade to the interfacing technology that is actually used.
Existing implementations are <code>org.hibersap.execution.jco.JCoContext</code> for the SAP Java Connector (JCo) or <code>org.hibersap.execution.jca.JCAContext</code> for a JCA compatible Resource Adapter (default: JCoContext).</p>
</dd>
<dt class="hdlist1">jca-connection-factory</dt>
<dd>
<p>The JNDI name of the JCA Connection Factory.
This parameter has to be specified if the application uses a JCA compatible resource adapter.
The resource adapter has to be deployed on the application server independently from Hibersap and the application, defining a JNDI name for each configured <code>ConnectionFactory</code>.
Hibersap will use this name to look up the resource adapter&#8217;s <code>ConnectionFactory</code>.</p>
</dd>
<dt class="hdlist1">jca-connectionspec-factory</dt>
<dd>
<p>The fully qualified class name of the <code>ConnectionSpecFactory</code> implementation used to get a <code>ConnectionSpec</code> object.
A <code>ConnectionSpec</code> is used to provide data such as a user name and password for the current session.
The existing implementations are <code>CuckooJcaAdapterConnectionSpecFactory</code> and <code>SapBapiJcaAdapterConnectionSpecFactory</code>.
Others may be added by implementing <code>org.hibersap.execution.jca.cci.ConnectionSpecFactory</code> interface.</p>
</dd>
<dt class="hdlist1">properties</dt>
<dd>
<p>Zero or more additional properties. These depend on the interfacing technology in use. For the SAP JCo, all the JCo-specific
properties must be defined here. See javadoc for the class <code>com.sap.conn.jco.ext.DestinationDataProvider</code> in the JCo distribution
to get a complete list of possible properties. For use with JCA, this element is not needed.</p>
</dd>
<dt class="hdlist1">annotated-classes</dt>
<dd>
<p>All annotated BAPI classes which are used with the <code>SessionManager</code> must be listed here.</p>
</dd>
<dt class="hdlist1">validation-mode</dt>
<dd>
<p>Specifies if Bean Validation (JSR-303) shall be used. Possible values are <code>NONE</code> to deactivate Bean Validation,
<code>AUTO</code> to activate Bean Validation only if a provider is available on the classpath, and <code>CALLBACK</code> to make sure
Bean Validation is used. With <code>CALLBACK</code>, Hibersap will throw an exception if no Bean Validation provider is
present at runtime.</p>
</dd>
<dt class="hdlist1">bapi-interceptor-classes</dt>
<dd>
<p>A list of the interceptor classes. These must implement <code>org.hibersap.interceptor.BapiInterceptor</code> and are called before and after a
SAP function module gets executed. Each interceptor must be defined with the fully qualified class name in a seperate
bapi-interceptor-class element.</p>
</dd>
<dt class="hdlist1">execution-interceptor-classes</dt>
<dd>
<p>A list of the interceptor classes. These must implement <code>org.hibersap.interceptor.ExecutionInterceptor</code> and are called before and after a
SAP function module gets executed. Each interceptor must be defined with the fully qualified class name in a seperate
execution-interceptor-class element.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>To build a <code>SessionManager</code> using XML file configuration, you simply have to create an object of class <code>org.hibersap.configuration.AnnotationConfiguration</code>, specifying the <code>SessionManager</code> name as an argument.
Note that there is also a default constructor for <code>AnnotationConfiguration</code> which can be used if there
is only one configured <code>SessionManager</code>. Hibersap will issue a warning when there are more than one `SessionManager`s
configured, but the no-args constructor is used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AnnotationConfiguration configuration= <span class="keyword">new</span> AnnotationConfiguration(<span class="string"><span class="delimiter">&quot;</span><span class="content">A12</span><span class="delimiter">&quot;</span></span>);
SessionManager sessionManager = configuration.buildSessionManager();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="programmatic-configuration"><a class="anchor" href="#programmatic-configuration"></a>3.2. Programmatic configuration</h3>
<div class="paragraph">
<p>After creating a <code>Configuration</code> object which will be used to build the <code>SessionManager</code>, configuration can be set or overwritten programmatically.</p>
</div>
<div class="paragraph">
<p>The information from the XML file is internally converted into a Java data structure reflecting the structure of the XML document.
All configuration classes have Java Bean style accessor methods (get.. and set..) for their fields.</p>
</div>
<div class="paragraph">
<p>When using programmatic configuration you have to change or create <code>SessionManagerConfig</code> for each <code>SessionManager</code> you want to use.
You can use method chaining to build the object.
The following example creates a <code>SessionManagerConfig</code> object that is equivalent to the one created internally when using XML file configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SessionManagerConfig cfg = <span class="keyword">new</span> SessionManagerConfig( <span class="string"><span class="delimiter">&quot;</span><span class="content">A12</span><span class="delimiter">&quot;</span></span> )
    .setContext( JCoContext.class.getName() )
    .setProperty( <span class="string"><span class="delimiter">&quot;</span><span class="content">jco.client.client</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">800</span><span class="delimiter">&quot;</span></span> )
    .setProperty( <span class="string"><span class="delimiter">&quot;</span><span class="content">jco.client.user</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sapuser</span><span class="delimiter">&quot;</span></span> )
    .setProperty( <span class="string"><span class="delimiter">&quot;</span><span class="content">jco.client.passwd</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> )
    .setProperty( <span class="string"><span class="delimiter">&quot;</span><span class="content">jco.client.lang</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span> )
    .setProperty( <span class="string"><span class="delimiter">&quot;</span><span class="content">jco.client.ashost</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">10.20.80.76</span><span class="delimiter">&quot;</span></span> )
    .setProperty( <span class="string"><span class="delimiter">&quot;</span><span class="content">jco.client.sysnr</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">00</span><span class="delimiter">&quot;</span></span> );

AnnotationConfiguration configuration = <span class="keyword">new</span> AnnotationConfiguration(cfg);
configuration.addBapiClasses( FlightListBapi.class, FlightDetailBapi.class );
SessionManager sessionManager = configuration.buildSessionManager();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="parameter-mapping"><a class="anchor" href="#parameter-mapping"></a>4. Parameter Mapping</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The main task of Hibersap is to map Remote Function Modules (RFMs)&#8201;&#8212;&#8201;which are defined in SAP ERP&#8201;&#8212;&#8201;to Java classes.
To accomplish this, Hibersap provides a set of Java annotations that map Java classes and their fields to the elements of the function module&#8217;s interface.
This section provides detailed information on the Hibersap annotations and on how data types are converted.</p>
</div>
<div class="paragraph">
<p>For a complete example of how to define Hibersap classes and mappings, see the <a href="/getstarted">Hibersap Get Started Guide</a> or checkout the Hibersap examples code from GitHub.</p>
</div>
<div class="sect2">
<h3 id="hibersap-annotations"><a class="anchor" href="#hibersap-annotations"></a>4.1. Hibersap Annotations</h3>
<div class="paragraph">
<p>Since Hibersap maps SAP Remote Function Modules to plain Java classes, an application must define one class for each function module that acts as a kind of proxy.
This class is called a BAPI class and has to be annotated with the <code>@Bapi</code> annotation.
(a <a href="https://en.wikipedia.org/wiki/Business_Application_Programming_Interface">BAPI</a>, Business Application Programming Interface, is actually a subset of all Remote Function Modules in a SAP ERP system but provides a more handy term).
The annotation&#8217;s <code>value</code> property defines the name of the corresponding function module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bapi</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">BAPI_SFLIGHT_GETLIST</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">FlightListBapi</span> {
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A function module&#8217;s interface usually has a set of parameters which are either of a scalar data type (such as a number, a text or a date) or of a complex data type (in ABAP a complex type is called structure, and provides a set of attributes of scalar or complex data type).
In Hibersap, scalar parameters can be mapped directly to a field of the BAPI Java class, whereas structures are mapped to complex Java types, i.e. classes with a set of fields.
The classes representing an ABAP structure may be annotated with the @BapiStructure annotation, but this is not mandatory.
Since Structure class instances need to be created by Hibersap, they must have a default constructor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@BapiStructure</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BapiRet2</span> {
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To map parameters of a function module to fields of Java classes, those fields have to be annotated with the <code>@Parameter</code> annotation.
Here, Hibersap needs to know the name of the function module&#8217;s parameter as well as its type (scalar or complex) using the annotation&#8217;s value and type properties respectively.
The Enumeration <code>ParameterType</code> defines the types <code>ParameterType.STRUCTURE</code> and <code>ParameterType.SIMPLE</code> for parameters of a complex or scalar type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Export</span>
<span class="annotation">@Parameter</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">RETURN</span><span class="delimiter">&quot;</span></span>, type = ParameterType.STRUCTURE)
<span class="directive">private</span> BapiRet2 returnData;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since the interface parameters of ABAP functions are divided into import, export and table parameters, Hibersap has to know where to find the corresponding parameters.
The @Import, @Export and @Table annotations provide this information.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@BapiStructure</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BapiRet2</span> {
    <span class="annotation">@Parameter</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">MESSAGE</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> message;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>ABAP tables are lists of complex parameters. As such they are mapped to a Java array or a <code>java.util.Collection</code> field.
Hibersap again needs to know the name of the ABAP parameter as provided by the <code>@Parameter</code> annotation and its type as provided by the <code>@Table</code> annotation.
It is a special characteristic of table parameters in ABAP that they import and export data in both directions.</p>
</div>
<div class="paragraph">
<p>An import or export parameter can also be a table, in which case the parameter needs to be annotated with <code>@Import</code> or <code>@Export</code> and <code>@Parameter(&#8230;&#8203;, type = ParameterType.TABLE_STRUCTURE)</code>.</p>
</div>
<div class="paragraph">
<p>Tables that import data to the function module are filled by the Java application, Hibersap will use the application-provided array or collection to populate the table.
Tables that export data from the function module will be read by Hibersap and copied to the corresponding array or collection.
Hibersap detects the type of its elements by the array type if it is declared as an array, or by its generic type if it is declared as a collection.
When using a collection, it is crucial to declare it with a generic type (the class Flight in the example), otherwise Hibersap will throw an error because it cannot determine the element type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bapi</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">BAPI_SFLIGHT_GETLIST</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">FlightListBapi</span> {
    <span class="annotation">@Table</span>
    <span class="annotation">@Parameter</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">FLIGHTLIST</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">List</span>&lt;Flight&gt; flightList;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The field representing a table does not need to be defined as a concrete implementation of the <code>java.util.Collection</code> interface.
When Hibersap creates a collection, it instantiates a <code>java.util.HashSet</code> for fields defined as <code>java.util.Set</code> and a <code>java.util.ArrayList</code> for fields defined as <code>java.util.Collection</code> or <code>java.util.List</code>.</p>
</div>
<div class="paragraph">
<p>The following list shows an overview of the Hibersap annotations.</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code><strong>@Bapi</strong></code>
</td>
<td class="hdlist2">
<p>Maps a Java class to a Remote Function Module in SAP.</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>value</code></dt>
<dd>
<p>The name of the RFM, e.g. <code>BAPI_FLIGHT_GETLIST</code></p>
</dd>
</dl>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code><strong>@BapiStructure</strong></code>
</td>
<td class="hdlist2">
<p>Maps the Java class to a structure in an RFM&#8217;s interface.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code><strong>@Parameter</strong></code>
</td>
<td class="hdlist2">
<p>Maps a field to a parameter of the RFM&#8217;s interface.</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>value</code></dt>
<dd>
<p>The parameter&#8217;s name as defined by the RFM.</p>
</dd>
<dt class="hdlist1"><code>type</code></dt>
<dd>
<p>The parameter&#8217;s type, <code>ParameterType.SIMPLE</code> for a scalar type, <code>ParameterType.STRUCTURE</code> for complex types, <code>ParameterType.TABLE_STRUCTURE</code> for table types. Default: <code>SIMPLE</code>. Table
parameters don&#8217;t need to specify this.</p>
</dd>
</dl>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code><strong>@Import</strong></code>
</td>
<td class="hdlist2">
<p>Defines a field annotated with <code>@Parameter</code> to be an import parameter.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code><strong>@Export</strong></code>
</td>
<td class="hdlist2">
<p>Defines a field annotated with <code>@Parameter</code> to be an export parameter.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code><strong>@Table</strong></code>
</td>
<td class="hdlist2">
<p>Defines a field annotated with <code>@Parameter</code> to be a table parameter. Since a table parameter always reflects an ABAP table type, the <code>@Parameter.type</code> value does not need to be explicitly set.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code><strong>@Convert</strong></code>
</td>
<td class="hdlist2">
<p>The parameter&#8217;s data type will be converted by the given converter, i.e. the Java field&#8217;s data type may differ from the JCo data type conversion pattern.</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>converter</code></dt>
<dd>
<p>An implementation of <code>org.hibersap.conversion.Converter</code>.</p>
</dd>
</dl>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code><strong>@ThrowExceptionOnError</strong></code>
</td>
<td class="hdlist2">
<p>Tells Hibersap to throw a <code>org.hibersap.SapException</code> when the function module returns errors in a <code>RETURN</code> structure or table.</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>returnStructure</code></dt>
<dd>
<p>Contains the path to the BAPI&#8217;s return structure or table, path elements are separated by a forward slash ('/'). The first element should be <code>EXPORT</code> or <code>TABLE</code> to indicate if the return structure is defined as an export or table parameter. The second element is the name of the return structure itself, usually <code>RETURN</code>. Default: &#8220;EXPORT/RETURN&#8221;.</p>
</dd>
<dt class="hdlist1"><code>errorMessageTypes</code></dt>
<dd>
<p>The ABAP message types which Hibersap shall interpret as an error.
The return structure&#8217;s field <code>TYPE</code> is compared to the message types. Default: "E", "A".</p>
</dd>
</dl>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="type-conversion"><a class="anchor" href="#type-conversion"></a>4.2. Type Conversion</h3>
<div class="sect3">
<h4 id="default-conversion-scheme"><a class="anchor" href="#default-conversion-scheme"></a>4.2.1. Default Conversion scheme</h4>
<div class="paragraph">
<p>The Java type of each simple field is closely related to the ABAP field&#8217;s data type.
When using Hibersap with JCo, it relies on the Java Connector&#8217;s conversion scheme as shown in the following table.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ABAP type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Java type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Character</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numerical character</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">D</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Byte field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte[]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">P</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Packed number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.BigDecimal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">I</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4-byte integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating point number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">STRING</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Variable-length character</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XSTRING</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Variable-length byte field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte[]</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When using Hibersap with JCA, it relies on the data types returned by the Resource Adapter.
Most Resource Adapters for SAP use JCo, so the above type conversion scheme will apply here, too.</p>
</div>
</div>
<div class="sect3">
<h4 id="custom-converters"><a class="anchor" href="#custom-converters"></a>4.2.2. Custom Converters</h4>
<div class="paragraph">
<p>Custom converters allow for converting a parameter&#8217;s data type to any Java type and vice versa.
A common example for a custom converter is one that converts boolean values.
ABAP does not have a boolean data type, a boolean in ABAP is usually represented by a character field of length 1.
It evaluates to true if the parameter&#8217;s value it equals to 'X', to false if the parameter&#8217;s value is empty.
With a Hibersap converter it is possible to map an ABAP "boolean" parameter to a <code>boolean</code> field in Java.</p>
</div>
<div class="paragraph">
<p>You can use Hibersap converters to do any kind of data type conversion. There are a few Converters defined in package <code>org.hibersap.conversion</code>. However, it is easy to write your own converter by implementing the <code>org.hibersap.conversion.Converter</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Converter</span>&lt;J, S&gt; <span class="directive">extends</span> <span class="predefined-type">Serializable</span>
{
    <span class="comment">/**
     * Convert the SAP value, as it is returned by the underlying
     * interfacing technology (e.g. the SAP Java Connector, JCo)
     * to the Java data type of the corresponding BAPI class field.
     * Hibersap will call this method after calling the SAP function
     * and before setting the field in the Java class.
     *
     * @param sapValue The object which is returned by the SAP interface
     * @return The converted value
     * @throws ConversionException if the value can not be converted
     */</span>
    J convertToJava( S sapValue ) <span class="directive">throws</span> ConversionException;

    <span class="comment">/**
     * Convert the Java value of the corresponding BAPI class field to
     * the data type as it is expected by the underlying interfacing
     * technology (e.g. the SAP Java Connector, JCo).
     * Hibersap will call this method before calling the SAP function.
     *
     * @param javaValue The value of the BAPI class field
     * @return The converted value
     * @throws ConversionException if the value can not be converted
     */</span>
    S convertToSap( J javaValue ) <span class="directive">throws</span> ConversionException;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use a converter, you simply annotate the field in the BAPI or Structure class with Hibersap&#8217;s <code>@Convert</code> annotation, specifying the converter that should be called:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Import</span>
<span class="annotation">@Parameter</span> ( <span class="string"><span class="delimiter">&quot;</span><span class="content">SHOW_DETAILS</span><span class="delimiter">&quot;</span></span> )
<span class="annotation">@Convert</span>( converter = BooleanConverter.class )
<span class="directive">private</span> <span class="directive">final</span> <span class="type">boolean</span> showDetails;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use converters not only with simple parameters, but also with structure and table parameters. In case of a structure parameter, the object passed to <code>Converter.convertToJava()</code> will be a <code>java.util.Map</code> with the structure parameter names as keys and the parameter values as values. <code>Converter.convertToSap()</code> must return a Map like this.</p>
</div>
<div class="paragraph">
<p>When using a converter with a table parameter, the object passed to <code>Converter.convertToJava()</code> is a <code>java.util.List</code> with <code>java.util.Map</code> instances as list elements. Each of these maps has the structure parameter name as the map&#8217;s key and the parameter&#8217;s value as the map&#8217;s value. <code>Converter.convertToSap()</code> must return a <code>List</code> of `Map`s of the same structure.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bean-validation"><a class="anchor" href="#bean-validation"></a>4.3. Bean Validation</h3>
<div class="paragraph">
<p>Java Bean Validation (JSR 303) is a Java EE standard which defines an API and metadata model (in the form of Java annotations) to validate Java Beans and their attributes. If a Bean Validation provider is on the classpath of your application, Hibersap will validate the BAPI and Structure classes each time before a function gets executed.</p>
</div>
<div class="paragraph">
<p>To configure Bean Validation for your Hibersap application you may specify the validation element in the hibersap XML configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hibersap&gt;</span>
  <span class="tag">&lt;session-manager</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
    <span class="tag">&lt;validation-mode&gt;</span>AUTO<span class="tag">&lt;/validation-mode&gt;</span>
    ...
  <span class="tag">&lt;/session-manager&gt;</span>
<span class="tag">&lt;/hibersap&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If using programmatic configuration, just set the <code>validationMode</code> property of the <code>SessionManagerConfig</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">sessionManagerConfig.setValidationMode( ValidationMode.AUTO );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The validation element may contain any of the values defined in <code>org.hibersap.configuration.xml.ValidationMode</code>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
AUTO
</td>
<td class="hdlist2">
<p>Use Bean Validation if a provider is found on the classpath (default).</p>
</td>
</tr>
<tr>
<td class="hdlist1">
CALLBACK
</td>
<td class="hdlist2">
<p>Force the use of Bean Validation. Hibersap will throw an exception if no provider is found on the classpath.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
NONE
</td>
<td class="hdlist2">
<p>Do not use Bean Validation, even if a provider is present.</p>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="calling-sap-functions"><a class="anchor" href="#calling-sap-functions"></a>5. Calling SAP Functions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="building-a-sessionmanager"><a class="anchor" href="#building-a-sessionmanager"></a>5.1. Building a SessionManager</h3>
<div class="paragraph">
<p>Chapter <a href="#configuration">Configuration</a> explains in detail how to configure Hibersap.
The following code snippet assumes that there is the <code>/META-INF/hibersap.xml</code> configuration file defining a session manager named "A12" in the application&#8217;s classpath and shows how to build a <code>SessionManager</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AnnotationConfiguration configuration= <span class="keyword">new</span> AnnotationConfiguration( <span class="string"><span class="delimiter">&quot;</span><span class="content">A12</span><span class="delimiter">&quot;</span></span> );
SessionManager sessionManager = configuration.buildSessionManager();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>SessionManager</code> should be created only once in an application&#8217;s lifetime since its creation is
It depends on the kind of application how to store the <code>SessionManager</code> instances. In a web application they may be created and closed in a <code>ServletContextListener</code> when starting and stopping the application, putting them into the servlet context.
In an EJB application this may be done using a Singleton EJB and its life-cycle methods and binding the individual SessionManager instances to JNDI.
In a stand-alone application the SessionManager might be simply passed around or managed by some dependency injection framework.</p>
</div>
</div>
<div class="sect2">
<h3 id="calling-a-function-in-sap"><a class="anchor" href="#calling-a-function-in-sap"></a>5.2. Calling a function in SAP</h3>
<div class="paragraph">
<p>Calling a remote function module in SAP is as easy as opening a new <code>Session</code> with the <code>SessionManager</code>, creating an instance of the BAPI class with the required parameters and passing it to the <code>Session.execute()</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Session session = sessionManager.openSession();
<span class="keyword">try</span> {
    FlightListBapi flightList = <span class="keyword">new</span> FlightListBapi( <span class="string"><span class="delimiter">&quot;</span><span class="content">DE</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Frankfurt</span><span class="delimiter">&quot;</span></span>,
                                                    <span class="string"><span class="delimiter">&quot;</span><span class="content">DE</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Berlin</span><span class="delimiter">&quot;</span></span>,
                                                    <span class="predefined-constant">null</span>, <span class="predefined-constant">false</span>, <span class="integer">10</span> );
    session.execute( flightList );
    showResult( flightList );
}
<span class="keyword">finally</span>
{
    session.close();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When calling <code>Session.execute()</code>, Hibersap populates the given Bapi object with the SAP function&#8217;s return parameters as defined in the parameter mappings.</p>
</div>
<div class="paragraph">
<p>A physical connection to the SAP system is created during the first call of <code>Session.execute()</code>.
It is crucial to close the Session when it is no longer needed.
If sessions are not closed, the connection pool (as managed by JCo or the resource adapter) may get exhausted.
Therefore it is strongly recommended to close the <code>Session</code> in a <code>finally</code> block like in the above example.
This makes sure the session gets closed even if an exception is thrown during execution of the <code>try</code> block.</p>
</div>
<div class="paragraph">
<p>Keep in mind that, if the application keeps sessions open for a long time, connections may also be shut down by the SAP system after some timeout period or there is some possibility that they may get broken due to network problems.
Thus, a session should have a short lifetime (just like a database session) and should only be used for a single unit of work.</p>
</div>
<div class="paragraph">
<p>Hibersap sessions are inexpensive to create, the Java Connector&#8217;s or Resource Adapter&#8217;s connection pool takes care of an efficient connection management (if properly configured), and Hibersap will not akquire a SAP connection before it is needed.</p>
</div>
</div>
<div class="sect2">
<h3 id="interceptors"><a class="anchor" href="#interceptors"></a>5.3. Interceptors</h3>
<div class="paragraph">
<p>There are two kind of interceptors that intercept calls to SAP function on different levels.
Both interceptor types make it possible for applications to apply additional logic which is related to cross-cutting concerns like e.g. logging.
Both interceptors are registered with a session manager in the Hibersap configuration and apply to all function calls using this session manager.</p>
</div>
<div class="sect3">
<h4 id="bapi-interceptors"><a class="anchor" href="#bapi-interceptors"></a>5.3.1. Bapi Interceptors</h4>
<div class="paragraph">
<p>Bapi Interceptors implement the <code>org.hibersap.interceptor.BapiInterceptor</code> interface and are called before and after a function call has been executed.
The interface defines the methods <code>beforeExecution( java.lang.Object )</code> and <code>afterExecution( java.lang.Object )</code>. As an argument, the Bapi object is passed to these methods.</p>
</div>
<div class="paragraph">
<p>E.g., Hibersap uses a Bapi Interceptor internally to apply Bean Validation (see class <code>org.hibersap.validation.BeanValidationInterceptor</code>).
Applications may of course add their own Bapi Interceptors.</p>
</div>
</div>
<div class="sect3">
<h4 id="execution-interceptors"><a class="anchor" href="#execution-interceptors"></a>5.3.2. Execution Interceptors</h4>
<div class="paragraph">
<p>Execution interceptors implement the <code>org.hibersap.interceptor.ExecutionInterceptor</code> interface and are also called before and after a function call has been executed.
The interface defines the methods <code>beforeExecution( org.hibersap.mapping.model.BapiMapping, java.util.Map&lt;String, Object&gt; )</code> and <code>afterExecution( org.hibersap.mapping.model.BapiMapping, java.util.Map&lt;String, Object&gt; )</code>.
In comparison to Bapi Interceptors, they are working on a lower level of the execution stack and provide information about the mapping of the Bapi class currently being executed as well as Hibersap&#8217;s internal representation of the parameters passed to and received from SAP.</p>
</div>
<div class="paragraph">
<p>The parameters are provided to the interceptor methods in terms of a <code>java.util.Map</code> with keys of type <code>java.util.String</code> specifying the parameter names and values of different types specifying the parameter values.
The map&#8217;s root elements have the keys "IMPORT", "EXPORT" and "TABLE" with a <code>java.util.Map</code> each containing the lists of the function&#8217;s import, export and table parameters respectively.
All other keys are the names of the SAP function&#8217;s parameters.
For scalar parameters values are of a simple Java type like numbers, dates or strings. For complex parameters values are of type <code>java.util.Map</code> with the type elements as key/value pairs. For table parameters the values are of type <code>java.util.List</code> with maps for each row.</p>
</div>
<div class="paragraph">
<p>An example structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">java.util.Map functionMap
  &quot;IMPORT&quot;: java.util.Map
    &lt;name import param simple&gt;: &lt;value import param1 simple&gt;
    &lt;name import param complex&gt;: java.util.Map
      &lt;name structure param 1&gt;: &lt;value structure param1&gt;
      &lt;name structure param 2&gt;: &lt;value structure param2&gt;
  &quot;TABLE&quot;: java.util.Map
    &lt;name table param&gt;: java.util.List
      &lt;list element 1&gt;
        java.util.Map
          &lt;name structure param1 row 1&gt;: &lt;value structure param1 row 1&gt;
          &lt;name structure param2 row 1&gt;: &lt;value structure param2 row 1&gt;
      &lt;list element 2&gt;
        java.util.Map
          &lt;name structure param1 row 2&gt;: &lt;value structure param1 row 2&gt;
          &lt;name structure param2 row 2&gt;: &lt;value structure param2 row 2&gt;
  ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>As an example, Hibersap internally uses an Execution Interceptor to detect errors when using the @ThrowExceptionOnError annotation (see class <code>org.hibersap.interceptor.impl.SapErrorInterceptor</code>). This way, the function&#8217;s parameter containing the error information does not need to be mapped to Java fields in the Bapi class to allow Hibersap to detect errors.</p>
</div>
<div class="paragraph">
<p>For use in applications Bapi Interceptors may suffice in most cases, are much easier to implement and should therefore be favored if sufficient for the use case. Execution Interceptors should only be used when the additional flexibility is needed.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="transactions"><a class="anchor" href="#transactions"></a>6. Transactions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SAP ERP allows external callers of its function modules to control logical units of work (i.e. transactions).
An application may call a number of function modules and commit or rollback all changes made during the function calls.
This is done by calling special function modules named <code>BAPI_TRANSACTION_COMMIT</code> and <code>BAPI_TRANSACTION_ROLLBACK</code>.</p>
</div>
<div class="paragraph">
<p>NOTE:
Please note that not all Remote Function Modules and even not all standard BAPIs in SAP R/3 support this feature.
Special care has to be taken in the ABAP code which should not call a COMMIT WORK itself. See SAP note 0131838, "Collective Note for BAPIs with the Commit Work Command" for a list of BAPIs that are not transaction enabled.</p>
</div>
<div class="paragraph">
<p>Using Hibersap, it is very easy to start and end transactions, you do not have to map and call these function modules yourself.
Depending on the chosen interfacing technology, you can either handle your transactions manually (JCo and JCA) or use Container Managed Transactions (JCA only).</p>
</div>
<div class="sect3">
<h4 id="manual-transaction-handling"><a class="anchor" href="#manual-transaction-handling"></a>6.1. Manual transaction handling</h4>
<div class="paragraph">
<p>The Hibersap Session has a method <code>beginTransaction()</code> which must be called when starting the transaction.
<code>beginTransaction()</code> returns a <code>Transaction</code> object on which you can later call the methods <code>commit()</code> or <code>rollback()</code> to tell SAP to commit or rollback all changes made during the transaction.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Session session = sessionManager.openSession();
Transaction transaction = <span class="predefined-constant">null</span>;
<span class="keyword">try</span>
{
    transaction = session.beginTransaction();
    session.execute( bapiObject1 );
    ...
    session.execute( bapiObjectN );
    transaction.commit();
}
<span class="keyword">catch</span> (<span class="exception">Exception</span> e)
{
    <span class="keyword">if</span> (transaction != <span class="predefined-constant">null</span>) {
        transaction.rollback();
    }
}
<span class="keyword">finally</span>
{
    session.close();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Java EE applications that make use of EJBs and Bean Managed Transactions (BMT) it is also necessary to explicitly start, commit and rollback transactions like in the code example.</p>
</div>
</div>
<div class="sect3">
<h4 id="automatic-transaction-handling"><a class="anchor" href="#automatic-transaction-handling"></a>6.2. Automatic transaction handling</h4>
<div class="paragraph">
<p>Applications running in an application server and using EJBs and a Java EE compatible Resource Adapter can profit from the application server&#8217;s capability to automatically handle transactions.
This is called Container Managed Transactions (CMT).</p>
</div>
<div class="paragraph">
<p>In case of using CMT, the application code does not have to take care of starting, committing and rolling back transactions.</p>
</div>
<div class="paragraph">
<p>See section <a href="#java-ee-integration">Java EE Integration</a> for a detailed discussion on Container Managed Transactions.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="authentification"><a class="anchor" href="#authentification"></a>7. Authentification</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="configured-user"><a class="anchor" href="#configured-user"></a>7.1. Configured User</h3>
<div class="paragraph">
<p>The most common way to interact with a SAP system in enterprise applications is to use a central SAP user that is shared by all users of the application.
Using this kind of authentication is a matter of configuration.
When using Hibersap with JCo, the user credentials are provided through Hibersap configuration, namely the JCo properties defined for a <code>SessionManager</code>.
When using Hibersap with JCA, the credentials are usually defined in the resource adapter configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="per-session-authentication"><a class="anchor" href="#per-session-authentication"></a>7.2. Per-session authentication</h3>
<div class="paragraph">
<p>If the application has to provide user credentials, e.g. when each application user logs on to the SAP system using his own SAP account, you can specify logon credentials for each Hibersap session you create.</p>
</div>
<div class="paragraph">
<p>In this case, when obtaining a <code>Session</code> from the <code>SessionManager</code>, the method <code>openSession( org.hibersap.session.Credentials )</code> must be used. The authentication information is specified in the <code>Credentials</code> object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Credentials credentials = <span class="keyword">new</span> Credentials()
    .setUser(<span class="string"><span class="delimiter">&quot;</span><span class="content">archibald_tuttle</span><span class="delimiter">&quot;</span></span>)
    .setPassword(<span class="string"><span class="delimiter">&quot;</span><span class="content">myPassw0rd</span><span class="delimiter">&quot;</span></span>)
    .setLanguage(<span class="string"><span class="delimiter">&quot;</span><span class="content">EN</span><span class="delimiter">&quot;</span></span>);
Session session = sessionManager.openSession( credentials );
session.execute( bapiClass );
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hibersap simply passes the attributes defined in the credentials object to SAP.
The following table lists the available attributes of the <code>Credentials</code> class including the corresponding JCo parameter as defined in interface <code>com.sap.conn.jco.ext.DestinationDataProvider</code> of the SAP Java Connector version 3.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Credentials field</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">JCo parameter</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SAP logon user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jco.client.user</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>aliasUser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SAP logon user alias, can be used instead of logon user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jco.client.alias_user</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>client</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SAP client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jco.client.client</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>language</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logon language ISO code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jco.client.lang</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logon password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jco.client.passwd</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ssoTicket</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SAP Cookie Version 2 as logon ticket for SSO based authentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jco.client.mysapsso2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>x509Certificate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X509 certificate for certificate based authentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jco.client.x509cert</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Using this method with JCo mode, Hibersap will internally create a custom JCo destination setting the specified credential attributes.
Note that in this case, every user needs to have the proper permissions in SAP to use the function modules that are called via Hibersap.</p>
</div>
<div class="paragraph">
<p>In addition to calling the function modules itself, JCo makes calls to the SAP system to obtain meta data on function modules, the so-called repository calls.
Those calls depend on different sets of permissions which the specific user might or might not have.
Therefore, JCo uses a configured user to do repository calls instead of the current user supplied with the Hibersap credentials object when creating custom destinations.
This user may either be configured via the JCo parameter <code>jco.client.user</code>, or with a separate user for repository calls using the parameter <code>jco.destination.repository.user</code>.
The latter is recommended for applications which make use of per-session authentication, for this makes sure the functions are always called with the session user and the repository calls are done with the repository user.
In this case, the property <code>jco.client.user</code> should not be set.</p>
</div>
<div class="paragraph">
<p>When using Hibersap with JCA, the configuration should be done accordingly, but is resource adapter specific.
The Cuckoo Resource Adapter defines almost all possible JCo properties and passes them on to the Java Connector.</p>
</div>
</div>
<div class="sect2">
<h3 id="single-sign-on"><a class="anchor" href="#single-sign-on"></a>7.3. Single sign-on</h3>
<div class="paragraph">
<p>A special case of per-session authentication is the use of single sign-on.
In a SAP environment it is common to use SAP Logon Tickets issued by SAP systems.
In a web application / portal scenario the ticket is stored in a cookie named <code>MYSAPSSO2</code> in the HTTP user session.
After obtaining this ticket it can be passed to the Hibersap session by setting the `Credentials.ssoTicket' field object like described in the previous section.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="java-ee-integration"><a class="anchor" href="#java-ee-integration"></a>8. Java EE Integration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When developing applications which run inside a Java EE application server and make use of Enterprise Java Beans (EJB), it is
recommended using Hibersap in combination with a JCA compatible resource adapter. A resource adapter offers some important features which will be treated in this section.</p>
</div>
<div class="sect2">
<h3 id="transaction-management"><a class="anchor" href="#transaction-management"></a>8.1. Transaction Management</h3>
<div class="paragraph">
<p>In an application server the JTA transaction manager handles transactions.
In combination with EJBs and container managed transactions (CMT), the application code does not need to care about transaction demarcation because the container sets the transaction boundaries implicitly. This simplifies development and reduces the probability of errors.</p>
</div>
<div class="paragraph">
<p>If using CMT, all the function calls to SAP which take place during a call to an EJB business method are running in one transaction.
When the EJB method returns normally, the transaction manager commits the transaction while in case of an error the transaction is automatically rolled back.
In this context, error means that either a <code>RuntimeException</code> is thrown or a Java EE application exception configured with the <code>rollback=true</code> attribute. (Note that Hibersap itself only throws unchecked exceptions.)</p>
</div>
<div class="paragraph">
<p>In EJB3, container managed transaction is the default transaction management demarcation.
However, can be explicitly declared using the <code>@TransactionManagement</code> annotation with a transaction management type of <code>CONTAINER</code> or <code>BEAN</code>.
The transaction semantics are further defined by the <code>@TransactionAttribute</code> annotation on the EJB class or the individual EJB methods where <code>TransactionAttributeType.REQUIRED</code> is a sensible default value.</p>
</div>
<div class="sect3">
<h4 id="distributed-transactions"><a class="anchor" href="#distributed-transactions"></a>8.1.1. Distributed Transactions</h4>
<div class="paragraph">
<p>In an application it might be necessary or wanted to access SAP and other resources like a database and/or a JMS message queue in one unit of work making sure either every resource is committed in the case of success, or every resource is rolled back in case of an error. To accomplish this, Java EE supports distributed transactions through the JTA transaction manager.</p>
</div>
<div class="paragraph">
<p>Unfortunately, SAP R/3 does not provide the two-phase commit protocol (2PC) which is necessary for a resource to participate in a distributed transaction.
The effect is that resource adapters for SAP R/3 support only local transactions, which is no problem if there is only one resource (the SAP R/3 system) enlisting in a transaction.
If there are multiple resources participating in a distributed transaction, the transaction manager starts a distributed transaction which requires 2PC aware resources as its participants.</p>
</div>
<div class="paragraph">
<p>The good news is that almost all of the modern application servers (including JBoss/Wildfly, Glassfish, Bea Weblogic and SAP WebAS) support a strategy called Last Resource Commit Optimization which makes it possible for a single non-2PC-aware resource (in our case SAP) to enlist in a distributed transaction.
This is transparent for the programmer.
However, as soon as there are two non-2PC-resources enlisting in the distributed transaction, the transaction manager will throw an error.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="security-management"><a class="anchor" href="#security-management"></a>8.2. Security Management</h3>
<div class="paragraph">
<p>With a resource adapter there are two different methods to authenticate with the SAP R/3 system: container managed and component managed authentication.
Hibersap supports both authentication methods.</p>
</div>
<div class="paragraph">
<p>With component managed authentication, an application passes credentials each time a connection is obtained from the resource adapter.
This method may be used when each user of the application signs in using its own SAP user, e.g. by entering the user name and password in the application or when using single sign-on with logon tickets.
In JCA, the credentials are passed with a <code>javax.resource.cci.ConnectionSpec</code> instance.
Internally, Hibersap will create this instance and fill it with information passed with the credentials object when a new session is opened. (The code is the same as in <a href="#per-session-authentication">Per-session authentication</a>.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Credentials credentials = <span class="keyword">new</span> Credentials()
    .setUser(<span class="string"><span class="delimiter">&quot;</span><span class="content">archibald_tuttle</span><span class="delimiter">&quot;</span></span>)
    .setPassword(<span class="string"><span class="delimiter">&quot;</span><span class="content">myPassw0rd</span><span class="delimiter">&quot;</span></span>);
Session session = sessionManager.openSession( credentials );
session.execute( bapiClass );
[...]</code></pre>
</div>
</div>
<div class="paragraph">
<p>With container managed authentication the sing-on information is either obtained from a JAAS login module or&#8201;&#8212;&#8201;in the simplest case&#8201;&#8212;&#8201;a central user and password is taken from the resource adapter&#8217;s configuration.
Using a login module, the sign-on information is passed by the container to the resource adapter with a <code>javax.security.auth.Security</code> object. Login module configuration is container specific.</p>
</div>
</div>
<div class="sect2">
<h3 id="jca-configuration"><a class="anchor" href="#jca-configuration"></a>8.3. JCA Configuration</h3>
<div class="paragraph">
<p>Another advantage of using a resource adapter over using JCo directly is that a resource adapter can be deployed and configured independently of the applications that use it.
Thus it is not necessary to reconfigure and redeploy all applications that connect to a SAP system whenever connection parameters (e.g. the SAP system&#8217;s host name) change.
Instead, only the resource adapter has to be reconfigured.
Since the configuration of the resource adapter specifies all the necessary properties to access the SAP system, in the Hibersap configuration you just need to specify the JNDI name that is used to look up the resource adapter&#8217;s connection factory.</p>
</div>
</div>
<div class="sect2">
<h3 id="hibersap-ejb-tools"><a class="anchor" href="#hibersap-ejb-tools"></a>8.4. Hibersap EJB tools</h3>
<div class="paragraph">
<p>If using Hibersap in a Java EE environment with Enterprise Java Beans, consider using the Hibersap EJB tools.
The EJB tools help in automatically creating Hibersap Sessions, injecting them into your EJBs and closing them.</p>
</div>
<div class="paragraph">
<p>The following code implements a Stateless Session EJB with a business method to search for Customers in SAP.
The EJB&#8217;s business methods are intercepted with the <code>HibersapSessionInterceptor</code>.
It has a field named <code>session</code> which is annotated with <code>@HibersapSession</code> to tell the interceptor which <code>SessionManager</code> to inject into the EJB.
The annotation&#8217;s <code>value</code> parameter specifies a JNDI name to which the <code>SessionManager</code> is bound.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stateless</span>
<span class="annotation">@Interceptors</span>( HibersapSessionInterceptor.class )
<span class="directive">public</span> <span class="type">class</span> <span class="class">CustomerServiceBean</span> <span class="directive">implements</span> CustomerService
{
    <span class="annotation">@HibersapSession</span>( <span class="string"><span class="delimiter">&quot;</span><span class="content">java:global/eis/hibersap/A12</span><span class="delimiter">&quot;</span></span> )
    <span class="directive">private</span> Session session;

    <span class="directive">public</span> CustomerSearch search( <span class="predefined-type">String</span> nameSearchPattern )
    {
        CustomerSearch customerSearch = <span class="keyword">new</span> CustomerSearch( nameSearchPattern );
        session.execute( customerSearch );
        <span class="keyword">return</span> customerSearch;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>CustomerSearch</code> is a Hibersap BAPI class. As can be seen, the code can directly use the injected Hibersap session to call functions in the SAP backend.
There is no need to close the Session, this is done by the interceptor.
The example uses container managed transactions and the method is called with transaction attribute <code>REQUIRED</code> (the default behaviour).
This makes sure the SAP call is transactional and will be committed or rolled back by the transaction manager after the EJB business method was executed.</p>
</div>
<div class="paragraph">
<p>Internally, the interceptor adds each created Hibersap session to the EJB&#8217;s session context to make sure that subsequent calls to other EJBs use the same session.
When the HibersapSessionInterceptor is executed, it first checks if a session of the specified session manager is already in the session context. If so, it uses the existing session, else a new session is created.</p>
</div>
<div class="paragraph">
<p>On returning from the business method for which the session was opened, the interceptor will close the session, thus making sure the underlying JCA connection will be returned to the connection pool.</p>
</div>
<div class="paragraph">
<p>To make the example complete we need a way to create a <code>SessionManager</code> and bind it to JNDI where it can be looked up by the interceptor.
The following code implements a singleton EJB with the <code>@Startup</code> annotation that is created when the application gets deployed.
The container will automatically call the lifecycle method <code>rebindSessionManager()</code> which is annotated with <code>@PostConstruct</code> when the EJB is started.
The method creates a session manager from a Hibersap XML configuration file and binds it to JNDI. When the application gets undeployed, the method <code>unbindSessionManager()</code> is called which removes the session manager from JNDI.
To actually bind and unbind the session manager to and from JNDI, the helper methods in class <code>JndiUtil</code> are used which is a part of the hibersap-ejb module.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Singleton</span>
<span class="annotation">@Startup</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">HibersapBootstrapBean</span>
{
    <span class="comment">// The JNDI name we will bind the Hibersap SessionManager to</span>
    <span class="comment">// (not the name of the JCA connection factory!)</span>
    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> JNDI_NAME = <span class="string"><span class="delimiter">&quot;</span><span class="content">java:jboss/eis/hibersap/SM_A12</span><span class="delimiter">&quot;</span></span>;

    <span class="annotation">@PostConstruct</span>
    <span class="directive">public</span> <span class="type">void</span> rebindSessionManager()
    {
        SessionManager sessionManager = <span class="keyword">new</span> AnnotationConfiguration(<span class="string"><span class="delimiter">&quot;</span><span class="content">A12</span><span class="delimiter">&quot;</span></span>).buildSessionManager();
        JndiUtil.rebindSessionManager( sessionManager, JNDI_NAME );
    }

    <span class="annotation">@PreDestroy</span>
    <span class="directive">public</span> <span class="type">void</span> unbindSessionManager()
    {
        JndiUtil.unbindSessionManager( JNDI_NAME )
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using Maven add the hibersap-ejb module to your application by defining the following dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.hibersap<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>hibersap-ejb<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>1.3.0<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-03-10 13:54:50 CET
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.0/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>
